<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>再来看看</title>
      <link href="/2025/01/21/new-life/"/>
      <url>/2025/01/21/new-life/</url>
      
        <content type="html"><![CDATA[<h3 id="你好2025"><a href="#你好2025" class="headerlink" title="你好2025"></a>你好2025</h3><p>许久未来，你好2025~</p>]]></content>
      
      
      <categories>
          
          <category> 随手记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用shell脚本高效的切换Git配置</title>
      <link href="/2022/12/04/shell-git/"/>
      <url>/2022/12/04/shell-git/</url>
      
        <content type="html"><![CDATA[<h3 id="一、摘要"><a href="#一、摘要" class="headerlink" title="一、摘要"></a>一、摘要</h3><p>很多时候，我们会遇到在同一个设备里同时配置了gitee和github的账号，甚至还有工作的gitlab账号，我们需要通过<code>git config --global user.name xxx</code>和<code>git config --global user.email xxx</code>来不断切换我们的身份，如果不切换，就会遇到用私人账号提交的工作工程的commit。这个时候就比较尴尬，这个时候，我们只需要简单的利用shell脚本帮我们运行配置即可。</p><h3 id="二、配置-ssh密钥"><a href="#二、配置-ssh密钥" class="headerlink" title="二、配置.ssh密钥"></a>二、配置.ssh密钥</h3><h4 id="生成多个-ssh密钥，对github-x2F-gitee-x2F-gitlab完成绑定【如已配置可跳过】"><a href="#生成多个-ssh密钥，对github-x2F-gitee-x2F-gitlab完成绑定【如已配置可跳过】" class="headerlink" title="生成多个.ssh密钥，对github&#x2F;gitee&#x2F;gitlab完成绑定【如已配置可跳过】"></a>生成多个.ssh密钥，对github&#x2F;gitee&#x2F;gitlab完成绑定【如已配置可跳过】</h4><ul><li>打开git bash，进入<code>C:\Users\[user]\.ssh</code>文件夹里</li><li>ssh-keygen -t rsa -C “这里换上你的邮箱”</li><li>回车 -&gt; 改名字 -&gt; 继续回车即可</li><li>生成后配置到相关的仓库即可<br><img src="https://zosah-1302154647.cos.ap-guangzhou.myqcloud.com/diary-blog/post/ssh-list.png" alt="ssh-list"></li></ul><h3 id="三、使用shell脚本切换"><a href="#三、使用shell脚本切换" class="headerlink" title="三、使用shell脚本切换"></a>三、使用shell脚本切换</h3><ul><li><p>新建一个.sh文件，命名为：user.sh</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">if [ $1 == &quot;current&quot; ]; then</span><br><span class="line">    git config --global --list</span><br><span class="line"></span><br><span class="line">elif [ $1 == &quot;gitlab&quot; ]; then</span><br><span class="line">    # 替换一下这里name和email即可</span><br><span class="line">    git config --global user.name &quot;aaa&quot;</span><br><span class="line">    git config --global user.email &quot;aaa@mailA.com&quot;</span><br><span class="line">    echo &quot;====&gt;&gt;&gt;&gt; 最新的配置：$1&quot;</span><br><span class="line">    git config --global --list</span><br><span class="line"></span><br><span class="line">elif [ $1 == &quot;gitee&quot; ]; then</span><br><span class="line">    # 替换一下这里name和email即可</span><br><span class="line">    git config --global user.name &quot;bbb&quot;</span><br><span class="line">    git config --global user.email &quot;bbb@mailB.com&quot;</span><br><span class="line">    echo &quot;====&gt;&gt;&gt;&gt; 最新的配置：$1&quot;</span><br><span class="line">    git config --global --list</span><br><span class="line"></span><br><span class="line">elif [ $1 == &quot;github&quot; ]; then</span><br><span class="line">    # 替换一下这里name和email即可</span><br><span class="line">    git config --global user.name &quot;ccc&quot;</span><br><span class="line">    git config --global user.email &quot;ccc@mailC.com&quot;</span><br><span class="line">    echo &quot;====&gt;&gt;&gt;&gt; 最新的配置：$1&quot;</span><br><span class="line">    git config --global --list</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">    echo &quot;====&gt;&gt;&gt;&gt; none：$1&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></li><li><p>把文件放在Git的bin目录下</p><blockquote><p>例如：D:\Git\usr\bin</p></blockquote></li><li><p>任意地方打开git bash执行</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- user.sh gitlab</span><br><span class="line">- user.sh gitee</span><br><span class="line">- user.sh github</span><br><span class="line">- user.sh current 可以快速查看当前的用户信息</span><br></pre></td></tr></table></figure></li></ul><h3 id="四、拓展-切换node版本"><a href="#四、拓展-切换node版本" class="headerlink" title="四、拓展 - 切换node版本"></a>四、拓展 - 切换node版本</h3><p>使用nvm管理node的时候，我们通常会使用命令nvm ls先查看一下版本，再使用nvm use xx.xx.xx来使用具体的某个版本的node。知道shell的原理后，我们也可以配置node的版本来进行快速切换。</p><ul><li>新建一个名为<code>cnode.sh</code>文件，同样放在Git的bin目录下<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">if [ $1 == &quot;10&quot; ]; then</span><br><span class="line">    nvm ls</span><br><span class="line">    nvm use 10.16.0</span><br><span class="line">elif [ $1 == &quot;12&quot; ]; then</span><br><span class="line">    nvm ls</span><br><span class="line">    nvm use 12.18.4</span><br><span class="line">elif [ $1 == &quot;14&quot; ]; then</span><br><span class="line">    nvm ls</span><br><span class="line">    nvm use 14.18.2</span><br><span class="line">elif [ $1 == &quot;16&quot; ]; then</span><br><span class="line">    nvm ls</span><br><span class="line">    nvm use 16.18.0</span><br><span class="line">else</span><br><span class="line">    echo &quot;====&gt;&gt;&gt;&gt; none：$1&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></li><li>这样就可以直接使用大版本号直接来切换node了<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">例如：cnode.sh 10 -&gt; 切换到10.16.0</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 提高效率 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序自定义头部胶囊</title>
      <link href="/2021/07/11/wechat-mp-capsule/"/>
      <url>/2021/07/11/wechat-mp-capsule/</url>
      
        <content type="html"><![CDATA[<p>需求：有时候需要自定义微信小程序的头部，而不使用默认的样式。</p><h4 id="1、关闭使用头部信息"><a href="#1、关闭使用头部信息" class="headerlink" title="1、关闭使用头部信息"></a>1、关闭使用头部信息</h4><p>对想要自定义的页面进行设置：xx.json，<br>关闭之后页面内容为铺满屏幕</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;navigationStyle&quot;</span>: <span class="string">&quot;custom&quot;</span>,</span><br><span class="line"><span class="string">&quot;enablePullDownRefresh&quot;</span>: <span class="literal">false</span></span><br></pre></td></tr></table></figure><h4 id="2、获得屏幕头部信息存到globalData"><a href="#2、获得屏幕头部信息存到globalData" class="headerlink" title="2、获得屏幕头部信息存到globalData"></a>2、获得屏幕头部信息存到globalData</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//app.json</span></span><br><span class="line"><span class="attr">globalData</span>: &#123;</span><br><span class="line">  <span class="attr">systeminfo</span>: &#123;&#125;, <span class="comment">// 系统信息</span></span><br><span class="line">  <span class="attr">headerBtnPosi</span>: &#123;&#125; <span class="comment">// 胶囊按钮位置信息</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="title function_">setHeaderBtn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 获取设备信息</span></span><br><span class="line">  wx.<span class="title function_">getSystemInfo</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">systeminfo</span> = res</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 获得胶囊按钮位置信息</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">headerBtnPosi</span> = <span class="title function_">wxgetMenuButtonBoundingClientRect</span>()</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="3、定义组件"><a href="#3、定义组件" class="headerlink" title="3、定义组件"></a>3、定义组件</h4><p><strong>headerNavBar.js</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="title function_">getApp</span>();</span><br><span class="line"><span class="title class_">Component</span>(&#123;</span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">    <span class="attr">navbarData</span>: &#123; <span class="comment">// 由父页面传递的数据</span></span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Object</span>,</span><br><span class="line">      <span class="attr">value</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">observer</span>: <span class="keyword">function</span> (<span class="params">newVal, oldVal</span>) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">haveBack</span>: <span class="literal">true</span>, <span class="comment">// 是否有返回按钮，true 有 false 没有 若从分享页进入则为 false</span></span><br><span class="line">    <span class="attr">statusBarHeight</span>: <span class="number">0</span>, <span class="comment">// 状态栏高度</span></span><br><span class="line">    <span class="attr">navbarHeight</span>: <span class="number">0</span>, <span class="comment">// 顶部导航栏高度</span></span><br><span class="line">    <span class="attr">navbarBtn</span>: &#123; <span class="comment">// 胶囊位置信息</span></span><br><span class="line">      <span class="attr">height</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">top</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">bottom</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">right</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 微信7.0.0支持wx.getMenuButtonBoundingClientRect()获得胶囊按钮高度</span></span><br><span class="line">  <span class="attr">attached</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> statusBarHeight = app.<span class="property">globalData</span>.<span class="property">systeminfo</span>.<span class="property">statusBarHeight</span> <span class="comment">// 状态栏高度</span></span><br><span class="line">    <span class="keyword">let</span> headerPosi = app.<span class="property">globalData</span>.<span class="property">headerBtnPosi</span> <span class="comment">// 胶囊位置信息</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * wx.getMenuButtonBoundingClientRect() 坐标信息以屏幕左上角为原点</span></span><br><span class="line"><span class="comment">     * 菜单按键宽度： 87</span></span><br><span class="line"><span class="comment">     * 菜单按键高度： 32</span></span><br><span class="line"><span class="comment">     * 菜单按键左边界坐标： 278</span></span><br><span class="line"><span class="comment">     * 菜单按键上边界坐标： 26</span></span><br><span class="line"><span class="comment">     * 菜单按键右边界坐标： 365</span></span><br><span class="line"><span class="comment">     * 菜单按键下边界坐标： 58</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">let</span> btnPosi = &#123; <span class="comment">// 胶囊实际位置，坐标信息不是左上角原点</span></span><br><span class="line">      <span class="attr">height</span>: headerPosi.<span class="property">height</span>,</span><br><span class="line">      <span class="attr">width</span>: headerPosi.<span class="property">width</span>,</span><br><span class="line">      <span class="comment">// 胶囊top - 状态栏高度</span></span><br><span class="line">      <span class="attr">top</span>: headerPosi.<span class="property">top</span> - statusBarHeight,</span><br><span class="line">      <span class="comment">// 胶囊bottom - 胶囊height - 状态栏height （现胶囊bottom 为距离导航栏底部的长度）</span></span><br><span class="line">      <span class="attr">bottom</span>: headerPosi.<span class="property">bottom</span> - headerPosi.<span class="property">height</span> - statusBarHeight,</span><br><span class="line">      <span class="comment">// 屏幕宽度 - 胶囊right</span></span><br><span class="line">      <span class="attr">right</span>: app.<span class="property">globalData</span>.<span class="property">systeminfo</span>.<span class="property">screenWidth</span> - headerPosi.<span class="property">right</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> haveBack;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">getCurrentPages</span>().<span class="property">length</span> === <span class="number">1</span>) &#123; <span class="comment">// 当只有一个页面时</span></span><br><span class="line">      haveBack = <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      haveBack = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">haveBack</span>: haveBack, <span class="comment">// 获取是否是通过分享进入的小程序</span></span><br><span class="line">      <span class="attr">statusBarHeight</span>: statusBarHeight,</span><br><span class="line">      <span class="attr">navbarHeight</span>: headerPosi.<span class="property">bottom</span> + btnPosi.<span class="property">bottom</span>, <span class="comment">// 原胶囊bottom + 现胶囊bottom</span></span><br><span class="line">      <span class="attr">navbarBtn</span>: btnPosi</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="attr">_goBack</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      wx.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">        <span class="attr">delta</span>: <span class="number">1</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">_goHome</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      wx.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/home/home&#x27;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>headerNavBar.wxml</strong></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自定义导航栏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;navbar-wrap &#123;&#123;navbarData.bgc?&#x27;bgc&#x27;:&#x27;&#x27;&#125;&#125; &#123;&#123;navbarData.float?&#x27;float&#x27;:&#x27;&#x27;&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">&#x27;height:&#123;&#123;navbarHeight&#125;&#125;px;padding-top:&#123;&#123;statusBarHeight&#125;&#125;px;&#x27;</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;navbar-text&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">&#x27;line-height:&#123;&#123;navbarBtn.height + navbarBtn.top&#125;&#125;px;&#x27;</span>&gt;</span></span><br><span class="line">    &#123;&#123;navbarData.title ? navbarData.title : &quot;&quot;&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;navbar-icon&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">wx:if</span>=<span class="string">&#x27;&#123;&#123;navbarData.showCapsule === 1 ? true : false&#125;&#125;&#x27;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">&quot;top:&#123;&#123;navbarBtn.top + statusBarHeight&#125;&#125;px;left:&#123;&#123;navbarBtn.right&#125;&#125;px;height:&#123;&#123;navbarBtn.height&#125;&#125;px;&quot;</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">image</span> <span class="attr">wx:if</span>=<span class="string">&#x27;&#123;&#123;haveBack&#125;&#125;&#x27;</span> <span class="attr">bindtap</span>=<span class="string">&quot;_goBack&quot;</span> <span class="attr">class</span>=<span class="string">&quot;floatL&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/assets/images/icon/navbar_back.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&#x27;&#123;&#123;haveBack&#125;&#125;&#x27;</span> <span class="attr">class</span>=<span class="string">&quot;line&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&#x27;&#123;&#123;haveBack&#125;&#125;&#x27;</span> <span class="attr">class</span>=<span class="string">&quot;floatL&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">image</span> <span class="attr">bindtap</span>=<span class="string">&quot;_goHome&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/assets/images/icon/navbar_home.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 手写loading --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;navbarData.showLoading&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;navbar-loading &#123;&#123;navbarData.float?&#x27;float&#x27;:&#x27;&#x27;&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&#x27;height:&#123;&#123;navbarHeight&#125;&#125;px;line-height:&#123;&#123;navbarHeight&#125;&#125;px;&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span>&gt;</span>···<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>headerNavBar.wxss</strong></p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.navbar-wrap</span> &#123;</span><br><span class="line"><span class="attribute">position</span>: fixed;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line"><span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">z-index</span>: <span class="number">9999999</span>;</span><br><span class="line"><span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bgc</span> &#123;</span><br><span class="line"><span class="attribute">background-color</span>: <span class="number">#B0E028</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.float</span> &#123;</span><br><span class="line"><span class="attribute">float</span>: left</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.navbar-text</span> &#123;</span><br><span class="line"><span class="attribute">position</span>: relative;</span><br><span class="line"><span class="attribute">top</span>: <span class="number">6</span>rpx;</span><br><span class="line"><span class="attribute">text-align</span>: center;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">36</span>rpx;</span><br><span class="line"><span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.navbar-icon</span> &#123;</span><br><span class="line"><span class="attribute">position</span>: fixed;</span><br><span class="line"><span class="attribute">display</span>: flex;</span><br><span class="line"><span class="attribute">border-radius</span>: <span class="number">70</span>rpx;</span><br><span class="line"><span class="attribute">border</span>: <span class="number">0.5px</span> solid <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>, <span class="number">0.4</span>);</span><br><span class="line"><span class="attribute">box-sizing</span>: border-box;</span><br><span class="line"><span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.2</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.navbar-icon</span> image &#123;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">20px</span>;</span><br><span class="line"><span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span> <span class="number">10px</span>;</span><br><span class="line"><span class="attribute">display</span>: inline-block;</span><br><span class="line"><span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.navbar-icon</span> view &#123;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">18px</span>;</span><br><span class="line"><span class="attribute">border-left</span>: <span class="number">0.5px</span> solid <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>, <span class="number">0.3</span>);</span><br><span class="line"><span class="attribute">margin-top</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.navbar-loading</span> &#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line"><span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.line</span> &#123;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">36</span>rpx;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">1</span>rpx;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>, <span class="number">0.4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4、使用"><a href="#4、使用" class="headerlink" title="4、使用"></a>4、使用</h4><p>1、对应页面引入组件</p><blockquote><p>“searchbar”: “&#x2F;components&#x2F;searchbar&#x2F;searchbar”</p></blockquote><p>2、页面js定义变量</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">navbarData</span>: &#123;</span><br><span class="line">  <span class="attr">showCapsule</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="comment">// 是否显示左上角胶囊按钮 1 显示 0 不显示</span></span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;测试标题&#x27;</span>, <span class="comment">// 导航栏 中间的标题</span></span><br><span class="line">  <span class="attr">bgc</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">showLoading</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">float</span>: <span class="literal">false</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>3、页面wxml引入</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">headerNavbar</span> <span class="attr">navbar-data</span>=<span class="string">&quot;&#123;&#123;navbarData&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">headerNavbar</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序嵌入腾讯地图</title>
      <link href="/2020/06/21/wechat-mp-map/"/>
      <url>/2020/06/21/wechat-mp-map/</url>
      
        <content type="html"><![CDATA[<p>需求：在微信小程序添加地址或者获取用户定位的时候要用到定位功能，获取用户坐标并逆向解析为实际地址</p><h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><ul><li>1、获取用户定位权限</li><li>2、使用腾讯位置服务提供的插件</li><li>3、拿到结果</li></ul><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><blockquote><p>申请腾讯地图账号：<br>参考 <a href="https://lbs.qq.com/miniProgram/jsSdk/jsSdkGuide/jsSdkOverview">https://lbs.qq.com/miniProgram/jsSdk/jsSdkGuide/jsSdkOverview</a></p></blockquote><ul><li>1、拿到账号支持的密钥</li><li>2、开通webserviceAPI服务</li><li>3、下载微信小程序JavaScriptSDK</li><li>4、配置安全域名</li></ul><h3 id="使用一、直接解析成地址"><a href="#使用一、直接解析成地址" class="headerlink" title="使用一、直接解析成地址"></a>使用一、直接解析成地址</h3><ul><li>1、导入qqmap-wx-jssdk.js</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在要使用服务的页面</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">QQMapWX</span> = <span class="built_in">require</span>(<span class="string">&#x27;../../untils/qqmap-wx-jssdk.js&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> qqmapsdk;</span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 实例化API核心类</span></span><br><span class="line">        qqmapsdk = <span class="keyword">new</span> <span class="title class_">QQMapWX</span>(&#123;</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;你在腾讯位置服务申请的key&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>2、获取定位权限<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">地图选点插件需要小程序提供定位授权才能够正常使用定位功能：</span><br><span class="line"><span class="comment">// app.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;permission&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;scope.userLocation&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;你的位置信息将用于小程序定位&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getAuthorize () &#123;</span><br><span class="line">  wx.<span class="title function_">authorize</span>(&#123;</span><br><span class="line">    <span class="attr">scope</span>: <span class="string">&#x27;scope.userLocation&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;有定位授权&#x27;</span>)</span><br><span class="line">      <span class="comment">//授权成功，此处调用获取定位函数</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">fail</span>(<span class="params"></span>) &#123;</span><br><span class="line">      wx.<span class="property">showModal</span> (&#123;</span><br><span class="line">        <span class="attr">cancelColor</span>: <span class="string">&#x27;cancelColor&#x27;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;没有授权无法获取位置信息&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&#x27;是否前往设置页面手动开启&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (res.<span class="property">confirm</span>) &#123;</span><br><span class="line">            wx.<span class="title function_">openSetting</span>(&#123;</span><br><span class="line">              <span class="attr">withSubscriptions</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">              <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">              <span class="attr">title</span>: <span class="string">&#x27;您取消了定位授权&#x27;</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li>3、直接解析成地址<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//此函数在用户定位授权成功后调用</span></span><br><span class="line"><span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  wx.<span class="title function_">getLocation</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;gcj02&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">      qqmapsdk.<span class="title function_">reverseGeocoder</span>(&#123;</span><br><span class="line">        <span class="attr">location</span>: &#123;</span><br><span class="line">          <span class="attr">latitude</span>: res.<span class="property">latitude</span>,</span><br><span class="line">          <span class="attr">longitude</span>: res.<span class="property">longitude</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">addressRes</span>) &#123; <span class="comment">//成功后的回调</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(addressRes);</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(addressRes.<span class="property">result</span>.<span class="property">address</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">          app.<span class="title function_">showTips</span>(<span class="string">&quot;定位获取失败，请手动输入地址&quot;</span>,<span class="string">&quot;none&quot;</span>, <span class="number">2000</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">complete</span>: <span class="keyword">function</span> (<span class="params">addressRes</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(addressRes);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="使用二、地图选址插件的使用"><a href="#使用二、地图选址插件的使用" class="headerlink" title="使用二、地图选址插件的使用"></a>使用二、地图选址插件的使用</h3><blockquote><p>优点：自带选图界面，点击选中后直接返回地址，少去自己写样式的烦恼</p></blockquote><ul><li><p>1、添加插件：登录微信公众号后台选择设置-第三方服务-插件管理，搜索 “腾讯位置服务地图选点” 申请，审核通过后，小程序开发者可在小程序内使用该插件。</p></li><li><p>2、配置插件</p><blockquote><p>参考：<a href="https://mp.weixin.qq.com/wxopen/pluginbasicprofile?action=intro&amp;appid=wx76a9a06e5b4e693e&amp;token=1620811584&amp;lang=zh_CN">https://mp.weixin.qq.com/wxopen/pluginbasicprofile?action=intro&amp;appid=wx76a9a06e5b4e693e&amp;token=1620811584&amp;lang=zh_CN</a></p></blockquote></li><li><p>3、使用</p></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">一、引入插件包：地图选点appId： wx76a9a06e5b4e693e</span><br><span class="line"><span class="comment">// app.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;chooseLocation&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.5&quot;</span>,</span><br><span class="line">      <span class="string">&quot;provider&quot;</span>: <span class="string">&quot;wx76a9a06e5b4e693e&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">二、授权配置：地图选点插件需要小程序提供定位授权才能够正常使用定位功能：</span><br><span class="line"><span class="comment">// app.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;permission&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;scope.userLocation&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;你的位置信息将用于小程序定位&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">三、使用：插件页面调用示例：</span><br><span class="line"><span class="keyword">const</span> chooseLocation = requirePlugin(<span class="string">&#x27;chooseLocation&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="comment">// 从地图选点插件返回后，在页面的onShow生命周期函数中能够调用插件接口，取得选点结果对象</span></span><br><span class="line">  onShow () &#123;</span><br><span class="line">    <span class="keyword">const</span> location = chooseLocation.<span class="title function_">getLocation</span>(); <span class="comment">// 如果点击确认选点按钮，则返回选点结果对象，否则返回null</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(location)</span><br><span class="line">  &#125;,</span><br><span class="line">  onUnload () &#123;</span><br><span class="line">    <span class="comment">// 页面卸载时设置插件选点数据为null，防止再次进入页面，geLocation返回的是上次选点结果</span></span><br><span class="line">    chooseLocation.<span class="title function_">setLocation</span>(<span class="literal">null</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    wx.<span class="title function_">getLocation</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;gcj02&#x27;</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> key = <span class="variable constant_">MAPKEY</span>; <span class="comment">//使用在腾讯位置服务申请的key</span></span><br><span class="line">        <span class="keyword">const</span> referer = <span class="string">&#x27;测试标题&#x27;</span>; <span class="comment">//调用插件的app的名称</span></span><br><span class="line">        <span class="keyword">const</span> location = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">          <span class="attr">latitude</span>: res.<span class="property">latitude</span>,</span><br><span class="line">          <span class="attr">longitude</span>: res.<span class="property">longitude</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">const</span> category = <span class="string">&#x27;生活服务,娱乐休闲&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">        wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">          <span class="attr">url</span>: <span class="string">`plugin://chooseLocation/index?key=<span class="subst">$&#123;key&#125;</span>&amp;referer=$  &#123;referer&#125;&amp;location=<span class="subst">$&#123;location&#125;</span>&amp;category=<span class="subst">$&#123;category&#125;</span>`</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 踩坑记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信小程序 </tag>
            
            <tag> 第三方Api </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用CryptoJS解决微信小程序用户信息解密</title>
      <link href="/2020/06/20/wechat-mp-CryptoJS/"/>
      <url>/2020/06/20/wechat-mp-CryptoJS/</url>
      
        <content type="html"><![CDATA[<p>前言：正常情况来说，微信小程序前端获取用户手机号是敏感操作，前端需要获得登录态后，把登录态的结果参数配合后端解码后返回解码后的结果。但是也存在纯前端解码的技术，纯前端解码原理就是把解码过程在前端js里面完成。但是不能用在实际开发中，因为请求域名不是合法配置的域名。这里只能用做前端测试用，实际开发还是需要后端请求返回。</p><p>插件下载：<a href="https://github.com/gwjjeff/cryptojs/archive/master.zip">https://github.com/gwjjeff/cryptojs/archive/master.zip</a></p><blockquote><p>问题描述：<br>wx.getUserInfo(OBJECT) 微信官方的这个获取用户信息的方法，需要对接口返回的加密数据( encryptedData )进行对称解密。</p></blockquote><hr><h3 id="微信官方有提供加密数据解密算法"><a href="#微信官方有提供加密数据解密算法" class="headerlink" title="微信官方有提供加密数据解密算法"></a>微信官方有提供加密数据解密算法</h3><p>接口如果涉及敏感数据（如wx.getUserInfo当中的 openId 和unionId ），接口的明文内容将不包含这些敏感数据。开发者如需要获取敏感数据，需要对接口返回的加密数据( encryptedData )进行对称解密。解密算法如下：</p><blockquote><p>1.对称解密使用的算法为 AES-128-CBC，数据采用PKCS#7填充。<br>2 对称解密的目标密文为 Base64_Decode(encryptedData)。<br>3.对称解密秘钥 aeskey &#x3D; Base64_Decode(session_key), aeskey 是16字节。<br>4.对称解密算法初始向量 为Base64_Decode(iv)，其中iv由数据接口返回。</p></blockquote><h3 id="纯前端解密使用方法"><a href="#纯前端解密使用方法" class="headerlink" title="纯前端解密使用方法"></a>纯前端解密使用方法</h3><p>1、下载包，将 CryptoJS 的包放入 小程序的 utils 中</p><p>2、封装 RdWXBizDataCrypt.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by rd on 2017/5/4.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 引入CryptoJS</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Crypto</span> = <span class="built_in">require</span>(<span class="string">&#x27;cryptojs/cryptojs.js&#x27;</span>).<span class="property">Crypto</span>;</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">getApp</span>();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">RdWXBizDataCrypt</span>(<span class="params">appId, sessionKey</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">appId</span> = appId</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sessionKey</span> = sessionKey</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="title class_">RdWXBizDataCrypt</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">decryptData</span> = <span class="keyword">function</span> (<span class="params">encryptedData, iv</span>) &#123;</span><br><span class="line">  <span class="comment">// base64 decode ：使用 CryptoJS 中 Crypto.util.base64ToBytes()进行 base64解码</span></span><br><span class="line">  <span class="keyword">var</span> encryptedData = <span class="title class_">Crypto</span>.<span class="property">util</span>.<span class="title function_">base64ToBytes</span>(encryptedData)</span><br><span class="line">  <span class="keyword">var</span> key = <span class="title class_">Crypto</span>.<span class="property">util</span>.<span class="title function_">base64ToBytes</span>(<span class="variable language_">this</span>.<span class="property">sessionKey</span>);</span><br><span class="line">  <span class="keyword">var</span> iv = <span class="title class_">Crypto</span>.<span class="property">util</span>.<span class="title function_">base64ToBytes</span>(iv);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 对称解密使用的算法为 AES-128-CBC，数据采用PKCS#7填充</span></span><br><span class="line">  <span class="keyword">var</span> mode = <span class="keyword">new</span> <span class="title class_">Crypto</span>.<span class="property">mode</span>.<span class="title function_">CBC</span>(<span class="title class_">Crypto</span>.<span class="property">pad</span>.<span class="property">pkcs7</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 解密</span></span><br><span class="line">    <span class="keyword">var</span> bytes = <span class="title class_">Crypto</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(encryptedData, key, &#123;</span><br><span class="line">        <span class="attr">asBpytes</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">iv</span>: iv,</span><br><span class="line">        <span class="attr">mode</span>: mode</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">var</span> decryptResult = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(bytes);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (decryptResult.<span class="property">watermark</span>.<span class="property">appid</span> !== <span class="variable language_">this</span>.<span class="property">appId</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> decryptResult</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">RdWXBizDataCrypt</span></span><br></pre></td></tr></table></figure><p>3、使用</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">APPID</span>, <span class="variable constant_">SECRET</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../../../../common/const&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">WXBizDataCrypt</span> = <span class="built_in">require</span>(<span class="string">&#x27;../../../../utils/RdWXBizDataCrypt.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//先登录</span></span><br><span class="line"><span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line">  wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">    <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="comment">//拿到登录态的code</span></span><br><span class="line">      <span class="keyword">var</span> code = res.<span class="property">code</span></span><br><span class="line">      wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;https://api.weixin.qq.com/sns/jscode2session?appid=&#x27;</span> + <span class="variable constant_">APPID</span> + <span class="string">&#x27;&amp;secret=&#x27;</span> + <span class="variable constant_">SECRET</span> + <span class="string">&#x27;&amp;js_code=&#x27;</span> + code + <span class="string">&#x27;&amp;grant_type=authorization_code&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123; code &#125;,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">          that.<span class="title function_">setData</span>(res.<span class="property">data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//再获得手机号</span></span><br><span class="line"><span class="title function_">getPhoneNumber</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">if</span> (e.<span class="property">detail</span>.<span class="property">errMsg</span> == <span class="string">&quot;getPhoneNumber:ok&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">//传入appid和session_key</span></span><br><span class="line">    <span class="keyword">var</span> pc = <span class="keyword">new</span> <span class="title class_">WXBizDataCrypt</span>(<span class="variable constant_">APPID</span>, <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">session_key</span>)</span><br><span class="line">    <span class="keyword">var</span> data = pc.<span class="title function_">decryptData</span>(e.<span class="property">detail</span>.<span class="property">encryptedData</span>, e.<span class="property">detail</span>.<span class="property">iv</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;解密后 data: &#x27;</span>, data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 踩坑记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信小程序 </tag>
            
            <tag> 解密 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
